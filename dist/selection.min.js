!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Selection=e():t.Selection=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="dist/",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s={};function n(t,e,i,s){let n,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};e instanceof HTMLCollection||e instanceof NodeList?n=Array.from(e):Array.isArray(e)||(n=[e]),Array.isArray(i)||(i=[i]);for(const e of n)for(const n of i)e[t](n,s,Object.assign({capture:!1},o));return Array.prototype.slice.call(arguments,1)}i.r(s),i.d(s,"on",function(){return o}),i.d(s,"off",function(){return l}),i.d(s,"css",function(){return a}),i.d(s,"intersects",function(){return h}),i.d(s,"selectAll",function(){return c}),i.d(s,"eventPath",function(){return u}),i.d(s,"removeElement",function(){return d}),i.d(s,"simplifyEvent",function(){return p}),i.d(s,"isElement",function(){return f});const o=n.bind(null,"addEventListener"),l=n.bind(null,"removeEventListener"),r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"px";return"number"==typeof t?t+e:""+t};function a(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=t&&t.style;if(s)if("object"==typeof e)for(let t in e)s[t]=r(e[t]);else{if(null==i){let i;const s=document.defaultView;return s&&s.getComputedStyle&&(i=s.getComputedStyle(t,null)),null==e?i:i[e]}s[e]=r(i)}}function h(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"touch";if("center"===i){const i=e.left+e.width/2,s=e.top+e.height/2;return i>=t.left&&i<=t.right&&s>=t.top&&s<=t.bottom}return"cover"===i?e.left>=t.left&&e.top>=t.top&&e.right<=t.right&&e.bottom<=t.bottom:"touch"===i?t.right>=e.left&&t.left<=e.right&&t.bottom>=e.top&&t.top<=e.bottom:void 0}function c(t){Array.isArray(t)||(t=[t]);const e=[];for(const i of t)e.push(...document.querySelectorAll(i));return e}function u(t){let e=t.composedPath&&t.composedPath();if(e)return e;let i=t.target.parentElement;for(e=[t.target,i];i=i.parentElement;)e.push(i);return e.push(document,window),e}function d(t,e){const i=t.indexOf(e);~i&&t.splice(i,1)}function p(t){const e=t.touches&&t.touches[0]||t;return{tap:e,x:e.clientX,y:e.clientY,target:e.target}}function f(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName}i.d(e,"Selection",function(){return m}),i.d(e,"create",function(){return g});class m{constructor(t){this.options={class:"selection-area",startThreshold:10,disableTouch:!1,mode:"touch",singleClick:!0,containers:[],selectables:[],startareas:["html"],boundaries:["html"],selectionAreaContainer:"body",scrollSpeedDivider:10,validateStart:t=>!0,onStart(t){t.selection,t.eventName,t.areaElement,t.originalEvent,t.selectedElements,t.changedElements},onSelect(t){t.target},onMove(t){},onStop(t){},selectionFilter:t=>(t.selection,t.eventName,t.element,!0)},this.selectedStore=[],this.areaElement=document.createElement("div"),this.clippingElement=document.createElement("div"),this.scrollAvailable=!0,this.scrollSpeed={x:null,y:null},this.selectionAreaContainer=null,this.areaStartX=0,this.areaStartY=0,this.areaEndX=0,this.areaEndY=0,this.boundaries=[],this.touchedElements=[],this.singleClick=!1,this.utils=Object.assign({},s),this.version="0.2.2",t&&Object.assign(this.options,t),this.init()}init(){this.utils.isElement(this.options.selectionAreaContainer)?this.selectionAreaContainer=this.options.selectionAreaContainer:this.selectionAreaContainer=document.querySelector(this.options.selectionAreaContainer),this.clippingElement.appendChild(this.areaElement),this.selectionAreaContainer.appendChild(this.clippingElement),this.utils.css(this.areaElement,{top:0,left:0,position:"fixed"}),this.utils.css(this.clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none"}),this.enable()}bindStartEvents(t){this.utils[t](document,"mousedown",this.onTapStart),this.options.disableTouch||this.utils[t](document,"touchstart",this.onTapStart,{passive:!1})}onTapStart(t){const e=this.utils.simplifyEvent(t),i=e.x,s=e.y,n=e.target.getBoundingClientRect();if(this.options.validateStart(t))return;const o=this.utils.selectAll(this.options.startareas);this.boundaries=this.utils.selectAll(this.options.boundaries);const l=this.utils.eventPath(t);if(o.find(t=>l.includes(t))&&this.boundaries.find(t=>l.includes(t))){if(this.areaStartX=i,this.areaStartY=s,this.areaEndX=0,this.areaEndY=0,this.singleClick=!0,this.resolveSelectables(),this.targetContainer=this.boundaries.find(t=>this.utils.intersects(t.getBoundingClientRect(),n)),this.targetBoundary=this.targetContainer.getBoundingClientRect(),this.touchedElements=[],this.changedElements={added:[],removed:[]},Math.round(this.targetContainer.scrollHeight)!==Math.round(this.targetBoundary.height)||Math.round(this.targetContainer.scrollWidth)!==Math.round(this.targetBoundary.width)){this.scrollAvailable=!0,this.utils.on(window,"wheel",this.manualScroll),this.selectables=this.selectables.filter(t=>this.targetContainer.contains(t));let t=this.targetBoundary,e=t.top,i=t.left,s=t.width,n=t.height;this.utils.css(this.clippingElement,{top:e,left:i,width:s,height:n}),this.utils.css(this.areaElement,{marginTop:-e,marginLeft:-i})}else this.scrollAvailable=!1,this.utils.css(this.clippingElement,{top:0,left:0,width:"100%",height:"100%"}),this.utils.css(this.areaElement,{marginTop:0,marginLeft:0});this.areaElement.classList.add(this.options.class),this.utils.on(document,"mousemove",this.delayedTapMove),this.utils.on(document,"touchmove",this.delayedTapMove,{passive:!1}),this.utils.on(document,["mouseup","touchcancel","touchend"],this.onTapStop),t.preventDefault()}}onSingleTap(t){let e=this.utils.simplifyEvent(t).target;for(;this.selectables.includes(e);){if(!e.parentElement)return;e=e.parentElement}this.touchedElements.push(e),this.dispatchEvent("onSelect",t,{target:e})}delayedTapMove(t){let e=this.utils.simplifyEvent(t),i=e.x,s=e.y;Math.abs(i+s)-(this.areaStartX+this.areaStartY)>=this.options.startThreshold&&(this.utils.off(document,["mousemove","touchmove"],this.delayedTapMove),this.utils.on(document,["mousemove","touchmove"],this.onTapMove),this.utils.css(this.areaElement,"display","block"),this.onTapMove(t),this.dispatchEvent("onStart",t),this.singleClick=!1)}onTapMove(t){let e=this.utils.simplifyEvent(t),i=e.x,s=e.y;if(this.areaEndX=i,this.areaEndY=s,!this.scrollAvailable||null===this.scrollSpeed.y&&null===this.scrollSpeed.x)this.redrawArea(),this.updatedTouchingElements(),this.dispatchEvent("onMove",t);else{const e=this.targetContainer;let i=s=>{if(null===this.scrollSpeed.y&&null===this.scrollSpeed.x)return;const n=e.scrollTop,o=e.scrollLeft;null!==this.scrollSpeed.y&&(e.scrollLeft+=Math.ceil(this.scrollSpeed.y/this.options.scrollSpeedDivider),this.areaStartY-=e.scrollTop-n),null!==this.scrollSpeed.x&&(e.scrollLeft+=Math.ceil(this.scrollSpeed.x/this.options.scrollSpeedDivider),this.areaStartX-=e.scrollLeft-o),this.redrawArea(),this.updatedTouchingElements(),this.dispatchEvent("onMove",t),requestAnimationFrame(i)};requestAnimationFrame(i)}}manualScroll(t){this.scrollSpeed.x+=this.options.scrollSpeedDivider*t.deltaX,this.scrollSpeed.y+=this.options.scrollSpeedDivider*t.deltaY,this.onTapMove(Object.assign(t,{changedTouches:new TouchList,targetTouches:new TouchList,touches:new TouchList})),t.preventDefault()}redrawArea(){const t=this.targetContainer,e=t.scrollHeight,i=t.scrollWidth,s=t.scrollLeft,n=t.scrollTop,o=t.clientHeight,l=t.clientWidth,r=this.targetBoundary;let a=this.areaEndX,h=this.areaEndY;a<r.left?(this.scrollSpeed.x=s?-Math.abs(r.left-a):null,a=r.left):a>r.left+r.width?(this.scrollSpeed.x=i-s-l?-Math.abs(r.left+r.width-a):null,a=r.left+r.width):this.scrollSpeed.x=null,h<r.top?(this.scrollSpeed.y=n?-Math.abs(r.top-h):null,h=r.top):h>r.top+r.height?(this.scrollSpeed.y=e-n-o?-Math.abs(r.top+r.height-h):null,h=r.top+r.height):this.scrollSpeed.y=null,this.utils.css(this.areaElement,{top:Math.min(this.areaStartX,a),left:Math.min(this.areaStartY,h),width:Math.max(this.areaStartX,a),height:Math.max(this.areaStartY,h)})}preventDefault(t){t.preventDefault()}onTapStop(t,e){this.utils.off(document,["mousemove","touchmove"],this.delayedTapMove),this.utils.off(document,["mousemove","touchmove"],this.onTapMove),this.utils.off(document,["mouseup","touchcancel","touchend"],this.onTapStop),this.singleClick&&this.options.singleClick?this.onSingleTap(t):this.singleClick||e||(this.updatedTouchingElements(),this.dispatchEvent("onStop",t)),this.scrollSpeed={x:null,y:null},this.utils.off(window,"wheel",this.manualScroll),this.utils.off(document,"selectstart",this.preventDefault(t)),this.utils.css(this.areaElement,"display","none")}updatedTouchingElements(){const t=[],e={added:[],removed:[]},i=this.options.mode,s=this.selectables,n=this.areaElement.getBoundingClientRect(),o=this.utils.intersects;for(let l of s)o(n,l.getBoundingClientRect(),i)&&!1!==this.dispatchFilterEvent("selectionFilter",l)&&(this.touchedElements.includes(l)||e.added.push(l),t.push(l));for(let i of this.touchedElements)t.includes(i)||e.removed.push(i);this.touchedElements=t,this.changedElements=e}dispatchFilterEvent(t,e){const i=this.options[t];if("function"==typeof i)return i.call(this,{selection:this,eventName:t,element:e})}dispatchEvent(t,e,i){const s=this.options[t];if("function"==typeof s)return s.call(this,Object.assign({selection:this,eventName:t,areaElement:this.areaElement,originalEvent:e,selectedElements:this.touchedElements.concat(this.selectedStore),changedElements:this.changedElements},i))}resolveSelectables(){this.selectables=this.utils.selectAll(this.options.selectables);const t=this.utils.selectAll(this.options.containers);for(let e of t)this.selectables.push(...e.querySelectorAll("*"))}keepSelection(){for(let t of this.touchedElements)this.selectedStore.includes(t)||this.selectedStore.push(t)}clearSelection(){this.selectedStore=[]}removeFromSelection(t){this.utils.removeElement(this.selectedStore,t),this.utils.removeElement(this.touchedElements,t)}get Selection(){return this.selectedStore}cancel(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.onTapStop(null,!t)}option(t,e){const i=this.options;return null==e?i[t]:i[t]=e}disable(){this.bindStartEvents("off")}destroy(){this.disable(),this.selectionAreaContainer.removeChild(this.clippingElement)}enable(){this.bindStartEvents("on")}}function g(t){return new m(t)}e.default=m}]).default});
//# sourceMappingURL=selection.min.js.map