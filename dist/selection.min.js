!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Selection=e():t.Selection=e()}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="dist/",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var i={};function o(t,e,n,i){let o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};e instanceof HTMLCollection||e instanceof NodeList?o=Array.from(e):Array.isArray(e)||(o=[e]),Array.isArray(n)||(n=[n]);for(const e of o)for(const o of n)e[t](o,i,Object.assign({capture:!1},s));return Array.prototype.slice.call(arguments,1)}n.r(i),n.d(i,"on",function(){return s}),n.d(i,"off",function(){return l}),n.d(i,"css",function(){return a}),n.d(i,"intersects",function(){return h}),n.d(i,"selectAll",function(){return c}),n.d(i,"eventPath",function(){return d}),n.d(i,"removeElement",function(){return u}),n.d(i,"simplifyEvent",function(){return p}),n.d(i,"isElement",function(){return f});const s=o.bind(null,"addEventListener"),l=o.bind(null,"removeEventListener"),r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"px";return"number"==typeof t?t+e:""+t};function a(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=t&&t.style;if(i)if("object"==typeof e)for(let t in e)i[t]=r(e[t]);else{if(null==n){let n;const i=document.defaultView;return i&&i.getComputedStyle&&(n=i.getComputedStyle(t,null)),null==e?n:n[e]}i[e]=r(n)}}function h(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"touch";if("center"===n){const n=e.left+e.width/2,i=e.top+e.height/2;return n>=t.left&&n<=t.right&&i>=t.top&&i<=t.bottom}return"cover"===n?e.left>=t.left&&e.top>=t.top&&e.right<=t.right&&e.bottom<=t.bottom:"touch"===n?t.right>=e.left&&t.left<=e.right&&t.bottom>=e.top&&t.top<=e.bottom:void 0}function c(t){Array.isArray(t)||(t=[t]);const e=[];for(const n of t)e.push(...document.querySelectorAll(n));return e}function d(t){let e=t.composedPath&&t.composedPath();if(e)return e;let n=t.target.parentElement;for(e=[t.target,n];n=n.parentElement;)e.push(n);return e.push(document,window),e}function u(t,e){const n=t.indexOf(e);~n&&t.splice(n,1)}function p(t){const e=t.touches&&t.touches[0]||t;return{tap:e,x:e.clientX,y:e.clientY,target:e.target}}function f(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName}n.d(e,"Selection",function(){return m}),n.d(e,"create",function(){return g});class m{constructor(t){this.options={class:"selection-area",startThreshold:10,disableTouch:!1,mode:"touch",singleClick:!0,containers:[],selectables:[],startareas:["html"],boundaries:["html"],selectionAreaContainer:"body",scrollSpeedDivider:10,validateStart:t=>(console.log(t),!0),onStart(t){t.selection,t.eventName,t.areaElement,t.originalEvent,t.selectedElements,t.changedElements},onSelect(t){t.target},onMove(t){},onStop(t){},selectionFilter:t=>(t.selection,t.eventName,t.element,!0)},this.selectedStore=[],this.areaElement=document.createElement("div"),this.clippingElement=document.createElement("div"),this.scrollAvailable=!0,this.scrollSpeed={x:null,y:null},this.selectionAreaContainer=null,this.areaStartX=0,this.areaStartY=0,this.areaEndX=0,this.areaEndY=0,this.boundaries=[],this.touchedElements=[],this.singleClick=!1,this.utils=i,this.version="0.2.2",t&&Object.assign(this.options,t),console.log(t,this.options),this.init()}init(){this.onTapMove=this.onTapMove.bind(this),this.onTapStart=this.onTapStart.bind(this),this.onTapStop=this.onTapStop.bind(this),this.onSingleTap=this.onSingleTap.bind(this),this.manualScroll=this.manualScroll.bind(this),this.delayedTapMove=this.delayedTapMove.bind(this),f(this.options.selectionAreaContainer)?this.selectionAreaContainer=this.options.selectionAreaContainer:this.selectionAreaContainer=document.querySelector(this.options.selectionAreaContainer),this.clippingElement.appendChild(this.areaElement),this.selectionAreaContainer.appendChild(this.clippingElement),a(this.areaElement,{top:0,left:0,position:"fixed"}),a(this.clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none"}),this.enable()}bindStartEvents(t){i[t](document,"mousedown",this.onTapStart),this.options.disableTouch||i[t](document,"touchstart",this.onTapStart,{passive:!1})}onTapStart(t){console.log(this);const e=p(t),n=e.x,i=e.y,o=e.target.getBoundingClientRect();if(!this.options.validateStart(t))return;const l=c(this.options.startareas);this.boundaries=c(this.options.boundaries);const r=d(t);if(l.find(t=>r.includes(t))&&this.boundaries.find(t=>r.includes(t))){if(this.areaStartX=n,this.areaStartY=i,console.log(n,i,this.areaStartX,this.areaStartY),this.areaEndX=0,this.areaEndY=0,this.singleClick=!0,this.resolveSelectables(),this.targetContainer=this.boundaries.find(t=>h(t.getBoundingClientRect(),o)),this.targetBoundary=this.targetContainer.getBoundingClientRect(),this.touchedElements=[],this.changedElements={added:[],removed:[]},Math.round(this.targetContainer.scrollHeight)!==Math.round(this.targetBoundary.height)||Math.round(this.targetContainer.scrollWidth)!==Math.round(this.targetBoundary.width)){this.scrollAvailable=!0,s(window,"wheel",this.manualScroll),this.selectables=this.selectables.filter(t=>this.targetContainer.contains(t));let t=this.targetBoundary,e=t.top,n=t.left,i=t.width,o=t.height;a(this.clippingElement,{top:e,left:n,width:i,height:o}),a(this.areaElement,{marginTop:-e,marginLeft:-n})}else this.scrollAvailable=!1,a(this.clippingElement,{top:0,left:0,width:"100%",height:"100%"}),a(this.areaElement,{marginTop:0,marginLeft:0});this.areaElement.classList.add(this.options.class),s(document,"mousemove",this.delayedTapMove),s(document,"touchmove",this.delayedTapMove,{passive:!1}),s(document,["mouseup","touchcancel","touchend"],this.onTapStop),t.preventDefault()}}onSingleTap(t){let e=p(t).target;for(;this.selectables.includes(e);){if(!e.parentElement)return;e=e.parentElement}this.touchedElements.push(e),this.dispatchEvent("onSelect",t,{target:e})}delayedTapMove(t){let e=p(t),n=e.x,i=e.y;Math.abs(n+i)-(this.areaStartX+this.areaStartY)>=this.options.startThreshold&&(l(document,["mousemove","touchmove"],this.delayedTapMove),s(document,["mousemove","touchmove"],this.onTapMove),a(this.areaElement,"display","block"),this.onTapMove(t),this.dispatchEvent("onStart",t),this.singleClick=!1)}onTapMove(t){let e=p(t),n=e.x,i=e.y;if(this.areaEndX=n,this.areaEndY=i,!this.scrollAvailable||null===this.scrollSpeed.y&&null===this.scrollSpeed.x)this.redrawArea(),this.updatedTouchingElements(),this.dispatchEvent("onMove",t);else{const e=this.targetContainer;let n=i=>{if(null===this.scrollSpeed.y&&null===this.scrollSpeed.x)return;const o=e.scrollTop,s=e.scrollLeft;null!==this.scrollSpeed.y&&(e.scrollTop+=Math.ceil(this.scrollSpeed.y/this.options.scrollSpeedDivider),this.areaStartY-=e.scrollTop-o),null!==this.scrollSpeed.x&&(e.scrollLeft+=Math.ceil(this.scrollSpeed.x/this.options.scrollSpeedDivider),this.areaStartX-=e.scrollLeft-s),this.redrawArea(),this.updatedTouchingElements(),this.dispatchEvent("onMove",t),requestAnimationFrame(n.bind(this))};requestAnimationFrame(n.bind(this))}}manualScroll(t){this.scrollSpeed.x+=this.options.scrollSpeedDivider*t.deltaX,this.scrollSpeed.y+=this.options.scrollSpeedDivider*t.deltaY,this.onTapMove(Object.assign(t,{changedTouches:new TouchList,targetTouches:new TouchList,touches:new TouchList})),t.preventDefault()}redrawArea(){const t=this.targetContainer,e=t.scrollHeight,n=t.scrollWidth,i=t.scrollLeft,o=t.scrollTop,s=t.clientHeight,l=t.clientWidth,r=this.targetBoundary;let h=this.areaEndX,c=this.areaEndY;h<r.left?(this.scrollSpeed.x=i?-Math.abs(r.left-h):null,h=r.left):h>r.left+r.width?(this.scrollSpeed.x=n-i-l?Math.abs(r.left+r.width-h):null,h=r.left+r.width):this.scrollSpeed.x=null,c<r.top?(this.scrollSpeed.y=o?-Math.abs(r.top-c):null,c=r.top):c>r.top+r.height?(this.scrollSpeed.y=e-o-s?Math.abs(r.top+r.height-c):null,c=r.top+r.height):this.scrollSpeed.y=null,a(this.areaElement,{left:Math.min(this.areaStartX,h),top:Math.min(this.areaStartY,c),width:Math.max(this.areaStartX,h)-Math.min(this.areaStartX,h),height:Math.max(this.areaStartY,c)-Math.min(this.areaStartY,c)})}preventDefault(t){t.preventDefault()}onTapStop(t,e){console.log("tabstop",i),l(document,["mousemove","touchmove"],this.delayedTapMove),l(document,["mousemove","touchmove"],this.onTapMove),l(document,["mouseup","touchcancel","touchend"],this.onTapStop),this.singleClick&&this.options.singleClick?this.onSingleTap(t):this.singleClick||e||(this.updatedTouchingElements(),this.dispatchEvent("onStop",t)),this.scrollSpeed={x:null,y:null},l(window,"wheel",this.manualScroll),l(document,"selectstart",this.preventDefault(t)),a(this.areaElement,"display","none")}updatedTouchingElements(){const t=[],e={added:[],removed:[]},n=this.options.mode,i=this.selectables,o=this.areaElement.getBoundingClientRect(),s=h;for(let l of i)s(o,l.getBoundingClientRect(),n)&&!1!==this.dispatchFilterEvent("selectionFilter",l)&&(this.touchedElements.includes(l)||e.added.push(l),t.push(l));for(let n of this.touchedElements)t.includes(n)||e.removed.push(n);this.touchedElements=t,this.changedElements=e}dispatchFilterEvent(t,e){const n=this.options[t];if("function"==typeof n)return n.call(this,{selection:this,eventName:t,element:e})}dispatchEvent(t,e,n){const i=this.options[t];if("function"==typeof i)return i.call(this,Object.assign({selection:this,eventName:t,areaElement:this.areaElement,originalEvent:e,selectedElements:this.touchedElements.concat(this.selectedStore),changedElements:this.changedElements},n))}resolveSelectables(){this.selectables=c(this.options.selectables);const t=c(this.options.containers);for(let e of t)this.selectables.push(...e.querySelectorAll("*"))}keepSelection(){for(let t of this.touchedElements)this.selectedStore.includes(t)||this.selectedStore.push(t)}clearSelection(){this.selectedStore=[]}removeFromSelection(t){u(this.selectedStore,t),u(this.touchedElements,t)}get Selection(){return this.selectedStore}cancel(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.onTapStop(null,!t)}option(t,e){const n=this.options;return null==e?n[t]:n[t]=e}disable(){this.bindStartEvents("off")}destroy(){this.disable(),this.selectionAreaContainer.removeChild(this.clippingElement)}enable(){this.bindStartEvents("on")}static create(t){return new m(t)}}function g(t){return new m(t)}e.default=m}]).default});
//# sourceMappingURL=selection.min.js.map